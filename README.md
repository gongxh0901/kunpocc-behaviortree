# è¡Œä¸ºæ ‘

> ä¸€ä¸ªç®€æ´ã€é«˜æ•ˆçš„ TypeScript è¡Œä¸ºæ ‘åº“ã€‚éµå¾ª"å¥½å“å‘³"è®¾è®¡åŸåˆ™ï¼šç®€å•æ•°æ®ç»“æ„ï¼Œæ¶ˆé™¤ç‰¹æ®Šæƒ…å†µï¼Œç›´æ¥æš´éœ²é—®é¢˜ã€‚

[![npm version](https://badge.fury.io/js/kunpocc-behaviortree.svg)](https://badge.fury.io/js/kunpocc-behaviortree)
[![License: ISC](https://img.shields.io/badge/License-ISC-blue.svg)](https://opensource.org/licenses/ISC)

## ç‰¹æ€§

- ğŸ¯ **ç®€æ´è®¾è®¡**: é›¶åºŸè¯ï¼Œç›´æ¥è§£å†³é—®é¢˜
- ğŸ”§ **ç±»å‹å®‰å…¨**: å®Œæ•´ TypeScript æ”¯æŒ
- ğŸš€ **é«˜æ€§èƒ½**: ä¼˜åŒ–çš„æ‰§è¡Œæœºåˆ¶ï¼Œæœ€å°å¼€é”€  
- ğŸ“¦ **é›¶ä¾èµ–**: çº¯å‡€å®ç°ï¼Œæ— ç¬¬ä¸‰æ–¹ä¾èµ–
- ğŸ”„ **çŠ¶æ€ç®¡ç†**: åˆ†å±‚é»‘æ¿ç³»ç»Ÿï¼Œæ•°æ®éš”ç¦»æ¸…æ™°

## å¿«é€Ÿå¼€å§‹

#### å®‰è£…

```bash
npm install kunpocc-behaviortree
```

#### å†…ç½®demo

é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ `bt-demo`æ–‡ä»¶å¤¹

demoæ˜¯åŸºäº`cocos creator3.8.6`åˆ¶ä½œçš„



## æ ¸å¿ƒæ¦‚å¿µ

### çŠ¶æ€ç±»å‹
```typescript
enum Status {
    SUCCESS,    // æˆåŠŸ
    FAILURE,    // å¤±è´¥  
    RUNNING     // è¿è¡Œä¸­
}
```

### èŠ‚ç‚¹ç±»å‹
- **ç»„åˆèŠ‚ç‚¹**: åŒ…å«å¤šä¸ªå­èŠ‚ç‚¹  (Composite)
- **è£…é¥°èŠ‚ç‚¹**: æœ‰ä¸”åªæœ‰ä¸€ä¸ªå­èŠ‚ç‚¹ï¼ˆDecoratorï¼‰ 
- **å¶å­èŠ‚ç‚¹**: ä¸èƒ½åŒ…å«å­èŠ‚ç‚¹ (LeafNode)
- **æ¡ä»¶èŠ‚ç‚¹**: ç‰¹æ®Šçš„å¶å­èŠ‚ç‚¹ (Condition)



## è£…é¥°å™¨

> **è‡ªè¡Œå®ç°çš„èŠ‚ç‚¹ï¼Œé€šè¿‡è£…é¥°å™¨æŠŠæ•°æ®æš´éœ²ç»™è¡Œä¸ºæ ‘ç¼–è¾‘å™¨**

##### ClassAction - è¡Œä¸ºèŠ‚ç‚¹è£…é¥°å™¨

##### ClassCondition - æ¡ä»¶èŠ‚ç‚¹è£…é¥°å™¨

##### ClassComposite - ç»„åˆèŠ‚ç‚¹è£…é¥°å™¨

##### ClassDecorator - è£…é¥°èŠ‚ç‚¹è£…é¥°å™¨

##### prop - å±æ€§è£…é¥°å™¨



## å†…ç½®èŠ‚ç‚¹

### ç»„åˆèŠ‚ç‚¹ (Composite)

##### Selector - é€‰æ‹©èŠ‚ç‚¹  
* é€‰æ‹©ç¬¬ä¸€ä¸ªæˆåŠŸçš„å­èŠ‚ç‚¹

##### Sequence - é¡ºåºèŠ‚ç‚¹
* æŒ‰é¡ºåºæ‰§è¡Œå­èŠ‚ç‚¹ï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­å­èŠ‚ç‚¹è¿”å›éSUCCESSï¼Œåˆ™è¿”å›å­èŠ‚ç‚¹çŠ¶æ€ï¼Œå…¨éƒ¨æˆåŠŸè¿”å›SUCCESS

##### Parallel - å¹¶è¡ŒèŠ‚ç‚¹
* æ‰§è¡Œæ‰€æœ‰å­èŠ‚ç‚¹ï¼Œå…¨éƒ¨æˆåŠŸæ‰æˆåŠŸ
* å¹¶ä¸æ˜¯çœŸæ­£çš„å¹¶è¡Œï¼Œä¹Ÿæœ‰æ‰§è¡Œé¡ºåº

##### RandomSelector - éšæœºé€‰æ‹©èŠ‚ç‚¹
* éšæœºé€‰æ‹©ä¸€ä¸ªå­èŠ‚ç‚¹æ‰§è¡Œ

##### ParallelAnySuccess - å¹¶è¡Œä»»ä¸€æˆåŠŸ
* åŒæ—¶æ‰§è¡Œæ‰€æœ‰å­èŠ‚ç‚¹ï¼Œä»»ä¸€æˆåŠŸå°±æˆåŠŸ



### è£…é¥°èŠ‚ç‚¹ (Decorator)

##### ConditionDecorator - æ¡ä»¶è£…é¥°èŠ‚ç‚¹

* å­ç±»éœ€å®ç°

  ```typescript
  /**
   * åˆ¤æ–­æ˜¯å¦æ»¡è¶³æ¡ä»¶
   * @returns æ˜¯å¦æ»¡è¶³æ¡ä»¶
   */
  protected abstract isEligible(): boolean;
  ```

##### Inverter - åè½¬èŠ‚ç‚¹
* åè½¬å­èŠ‚ç‚¹çš„æˆåŠŸ/å¤±è´¥çŠ¶æ€

##### LimitTime - æ—¶é—´é™åˆ¶

* è§„å®šæ—¶é—´å†…,  å‘çˆ¶èŠ‚ç‚¹è¿”å›å­èŠ‚ç‚¹çš„ç»“æœï¼Œè¶…æ—¶åè¿”å›å¤±è´¥

##### LimitTicks - æ¬¡æ•°é™åˆ¶

* æ‰§è¡Œæ¬¡æ•°(å­èŠ‚ç‚¹éRUNNNGçŠ¶æ€)å†…ï¼Œå‘çˆ¶èŠ‚ç‚¹è¿”å›å­èŠ‚ç‚¹çš„ç»“æœï¼Œè¶…è¿‡æ¬¡æ•°åè¿”å›å¤±è´¥

##### Repeat - é‡å¤èŠ‚ç‚¹
* é‡å¤æ‰§è¡ŒæŒ‡å®šæ¬¡æ•°

##### RepeatUntilSuccess - é‡å¤ç›´åˆ°æˆåŠŸ

* è®¾ç½®æœ€å¤§é‡è¯•æ¬¡æ•°

##### RepeatUntilFailure - é‡å¤ç›´åˆ°å¤±è´¥  

* è®¾ç½®æœ€å¤§é‡è¯•æ¬¡æ•°

##### WeightDecorator - æƒé‡è£…é¥°èŠ‚ç‚¹

* ç”¨äºéšæœºé€‰æ‹©èŠ‚ç‚¹çš„å­èŠ‚ç‚¹çš„æŒ‰æƒé‡éšæœº



### å¶å­èŠ‚ç‚¹ (LeafNode)

##### LeafNode - å¶å­èŠ‚ç‚¹åŸºç±»

##### WaitTicks - æ¬¡æ•°ç­‰å¾…èŠ‚ç‚¹

##### WaitTime - æ—¶é—´ç­‰å¾…èŠ‚ç‚¹

### æ¡ä»¶èŠ‚ç‚¹ (Condition)

##### Condition - æ¡ä»¶èŠ‚ç‚¹åŸºç±»

* ç‰¹æ®Šçš„å¶å­èŠ‚ç‚¹ï¼Œå­ç±»éœ€å®ç°

  ```typescript
  /**
   * åˆ¤æ–­æ˜¯å¦æ»¡è¶³æ¡ä»¶
   * @returns æ˜¯å¦æ»¡è¶³æ¡ä»¶
   */
  protected abstract isEligible(): boolean;
  ```

  

## é»‘æ¿ç³»ç»Ÿ

é»‘æ¿ç³»ç»Ÿæä¾›åˆ†å±‚æ•°æ®å­˜å‚¨ï¼Œæ”¯æŒæ•°æ®éš”ç¦»å’ŒæŸ¥æ‰¾é“¾ï¼š

```typescript
// åœ¨èŠ‚ç‚¹ä¸­ä½¿ç”¨é»‘æ¿
new Action((node) => {
    // ç›´æ¥è·å–å®ä½“
    const entity = node.getEntity<Character>();
    
    // æœ¬åœ°æ•°æ®ï¼ˆä»…å½“å‰èŠ‚ç‚¹å¯è§ï¼‰
    node.set('local_count', 1);
    const count = node.get<number>('local_count');
    
    // æ ‘çº§æ•°æ®ï¼ˆæ•´æ£µæ ‘å¯è§ï¼‰
    node.setRoot('tree_data', 'shared');
    const shared = node.getRoot<string>('tree_data');
    
    // å…¨å±€æ•°æ®ï¼ˆæ‰€æœ‰æ ‘å¯è§ï¼‰
    node.setGlobal('global_config', config);
    const config = node.getGlobal<Config>('global_config');
    
    return Status.SUCCESS;
})
```



## è®¸å¯è¯

ISC License - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestã€‚è¯·ç¡®ä¿ï¼š
1. ä»£ç é£æ ¼ä¸€è‡´
2. æ·»åŠ é€‚å½“çš„æµ‹è¯•
3. æ›´æ–°ç›¸å…³æ–‡æ¡£

---

*"å¥½çš„ç¨‹åºå‘˜å…³å¿ƒæ•°æ®ç»“æ„ï¼Œè€Œä¸æ˜¯ä»£ç ã€‚"* - è¿™ä¸ªåº“éµå¾ªç®€æ´è®¾è®¡åŸåˆ™ï¼Œä¸“æ³¨äºè§£å†³å®é™…é—®é¢˜ã€‚